# Terraformコード開発環境の選定について

TerraformはエディターとTerraformを実行可能な環境さえあればコードの開発が可能です。  
TerraformはWindows/Linux/Macで実行可能であり、特殊な環境を用意する必要はないため、基本的には自分の好きな環境で開発を行っても問題ありません。  
ただし、効率的な開発を行うために、以下の要件を満たす環境を用意することをオススメします。

- インターネットに接続されている
- Terraformを実行できる
    - 検証環境等のAWS環境へのアクセス権限がある
- VSCodeのような高機能のエディターを利用できる
- 便利なTerraformの周辺ツールや一般的なコーディングで役立つツールを利用できる
- Gitを利用できる

## 開発環境のパターン

メイン端末のOSをWindowsとする場合、以下のパターンが考えられます。

1. WindowsにGitやTerraformをインストールし、VSCodeで開発を行う
2. WSL2等を利用してWindows内にLinux環境を構築し、VSCodeのRemote SSHで接続して開発を行う
3. クラウド上にEC2インスタンス等のLinux環境を立ち上げて、VSCodeのRemote SSHで接続して開発を行う

いずれも、環境構築の容易さやコストなどでメリットデメリットがあるため、自分の好みやプロジェクトの要件に合わせて選定を行ってください。  
ただし、Windowsには対応していないツールが多いこと、Proxy環境下ではWSL2の利用に制限がある場合があることから、基本的には3のクラウド上に環境を構築する方法が細かなトラブルが生じにくくてオススメです。

また、クラウド上に環境を構築する場合は環境そのものもTerraformで作成しておくことをオススメします。  
環境構築のコードを作成しておくことで環境依存の問題や最初のハードルである環境構築の作業を省略できます。

## クラウド上に環境を構築する場合の注意点

クラウド上に環境を構築する場合、以下の点に注意する必要があります。

- セキュアな運用を行う
- ムダなコストが発生しないようにする
- 消えたら困るデータは置かない

### セキュアな運用を行う

クラウド上に環境を構築する場合、セキュリティに関する問題が発生する可能性があります。  
AWSのEC2インスタントの場合は以下の点に注意してください。

- SSHではなく、セッションマネージャーを利用した接続を行う
- セキュリティグループで必要なポートのみを開放する
    - Terraform実行の用途のみであれば、ポートを何も開放する必要ない
- アクセスキーではなく、IAMロールの権限でTerraformを実行できるようにする
    - Terraform開発の場合、Administrator権限を持たせることになる場合が多い
    - インスタンスプロファイルに直接権限の強いIAMロールを付与するか、AssumeRoleを利用して一時的に権限の強いIAMロールを使用する方法がある

### ムダなコストが発生しないようにする

クラウド上のリソースを使用するため、なるべくコストをを抑える運用を行うようにするのが望ましいです。  
コストを抑えるためには以下のような方法があります。

- コストのかかるリソースは使わないようにする
    - Amazon LinuxのAMIを利用する
    - リソース不足にならない程度に安いインスタンスタイプを使用する
    - EBSを不必要に大きさサイズにしない
    - EBSのスナップショットを取らない
- EventBridgeやOSのCronを使ってインスタンスを決まった時刻で自動停止するようにしておく

### 消えたら困るデータは置かない

クラウド上に作成する環境は基本的に使い捨ての環境です。いつでもすぐに削除できる状態にしておくのが望ましいです。  
なかなか消せない状態にしてしまうと、コストがかかるだけでなく、セキュリティリスクにもなります。
